<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<title>Twilight Brightness Atlas</title>
<meta name="viewport" content="width=device-width, initial-scale=1" />

<script src="brightness_data.js"></script>
<script src="heatmap.js"></script>


<script src="https://cdn.jsdelivr.net/npm/gsap@3/dist/gsap.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/gsap@3/dist/ScrollTrigger.min.js"></script>

<style>
html, body {
  margin: 0;
  background: #0b0c0f;
  color: white;
  overflow-x: hidden;
  font-family: system-ui, -apple-system, BlinkMacSystemFont;
}

/* ---------- HERO SCENE ---------- */
#hero {
  height: 100vh;
}

#hero-canvas {
  position: fixed;
  inset: 0;
  width: 100vw;
  height: 100vh;
  z-index: 0;
}
#noise-canvas {
  position: fixed;
  inset: 0;
  width: 100vw;
  height: 100vh;
  pointer-events: none;
  z-index: 1;          /* hero-canvas ìœ„ì— ê²¹ì³ì•¼ í•˜ë‹ˆê¹Œ */
  opacity: 0.08;       /* ğŸ”¥ ì•„ì£¼ ì•½í•˜ê²Œ */
  mix-blend-mode: screen;  /* ì„ íƒ: ì§ˆê°ì´ ìì—°ìŠ¤ëŸ½ê²Œ ì„ì„ */
  
}

/* BIG TYPO */
.hero-title {
  position: fixed;
  top: 35%;
  left: 50%;
  transform: translate(-50%, -50%);

  font-size: 11.5vw;
  line-height: 0.9;
  font-weight: 700;
  letter-spacing: -0.045em;
  text-align: center;

  /* ê¸°ë³¸ ìƒ‰ + ë…¸ë€ë¼ ìœ ì§€ */
  color: rgba(255,255,255,0.85);
  mix-blend-mode: overlay;


  /* ì„ íƒ: ì‚´ì§ ê¹Šì´ë§Œ */
  text-shadow:
  0 0 0.6px rgba(255,255,255,0.9),
  0 0 1.2px rgba(255,255,255,0.6),
  0 0 10px rgba(255,255,255,0.15);


  z-index: 2;
  pointer-events: none;
}


#hero-title-line1,
#hero-title-line2 {
  display: inline-block;
  white-space: nowrap;
}




/* SCROLL LENGTH */
#spacer {
  height: 220vh;
}

/* ---------- GALLERY ---------- */
#gallery {
  position: relative;
  z-index: 2;
  padding: 120px 80px;
  background: #0b0c0f;
}

#gallery h2 {
  font-size: 20px;
  font-weight: 500;
  margin-bottom: 24px;
  opacity: 0.8;
}

.mini-grid {
  display: grid;
  grid-template-columns: repeat(3, 1fr);
  gap: 20px;
}

.mini-card {
  cursor: pointer;
}

.mini-title {
  font-size: 12px;
  opacity: 0.6;
  margin-bottom: 8px;
}

.mini-card canvas {
  width: 100%;
  height: auto;
  display: block;
}
.mini-card {
  border-radius: 14px;
  overflow: hidden;                 /* í™•ëŒ€ë  ë•Œ ì‚ì ¸ë‚˜ì˜¤ì§€ ì•Šê²Œ */
  transition: transform 220ms ease, filter 220ms ease;
  transform-origin: center center;
  will-change: transform;
}

.mini-card:hover {
  transform: scale(1.035);          /* â€œì‚´ì§â€ í™•ëŒ€ */
  filter: brightness(1.03) contrast(1.02);  /* ì„ íƒ: ë¯¸ì„¸í•˜ê²Œ ìƒê¸° */
}
#hero-title-line2 {
  filter: brightness(1.15);
}
/* ---------- AXIS / LEGEND / TOOLTIP ---------- */
.axis{
  position: fixed;
  z-index: 3;
  font-size: 11px;
  letter-spacing: 0.08em;
  color: rgba(255,255,255,0.55);
  pointer-events: none;
  text-transform: uppercase;
}

#axis-y{
  left: 18px;
  top: 10vh;
  height: 80vh;
}
#axis-y .tick{
  position: absolute;
  left: 0;
  transform: translateY(-50%);
  opacity: 0.75;
}

#axis-x{
  left: 10vw;
  bottom: 16px;
  width: 80vw;
  display: flex;
  justify-content: space-between;
}
#axis-x span{ opacity: 0.7; }

#legend{
  position: fixed;
  right: 18px;
  top: 50%;
  transform: translateY(-50%);
  z-index: 3;
  display: grid;
  grid-template-columns: auto;
  gap: 10px;
  align-items: center;
}
#legend-title{
  writing-mode: vertical-rl;
  font-size: 10px;
  opacity: 0.5;
}
#legend-bar{
  width: 14px;
  height: 200px;
  border-radius: 10px;
  background: #fff; /* JSì—ì„œ ì •í™•í•œ gradientë¡œ ë®ì–´ì”€ */
}
#legend-ticks{
  position: absolute;
  right: 22px;
  top: 0;
  height: 200px;
  display: flex;
  flex-direction: column;
  justify-content: space-between;
  font-size: 10px;
  opacity: 0.55;
}

#tooltip{
  position: fixed;
  z-index: 9999;
  padding: 8px 10px;
  font-size: 11px;
  background: rgba(0,0,0,0.78);
  border: 1px solid rgba(255,255,255,0.12);
  border-radius: 10px;
  color: rgba(255,255,255,0.92);
  pointer-events: none;
  opacity: 0;
  transform: translate(12px, 12px);
  white-space: nowrap;
}
#tooltip{
  position: fixed;
  z-index: 9999;
  padding: 8px 10px;
  font-size: 11px;
  background: rgba(0,0,0,0.78);
  border: 1px solid rgba(255,255,255,0.12);
  border-radius: 10px;
  color: rgba(255,255,255,0.92);
  pointer-events: none;
  opacity: 0;
  transform: translate(12px, 12px);
  white-space: nowrap;
}
#legend {
  position: absolute;
  right: 28px;
  top: 50%;
  transform: translateY(-50%);

  display: flex;
  align-items: center;
  gap: 10px;

  font-family: system-ui, sans-serif;
  color: rgba(255,255,255,0.6);
}

.legend-scale {
  position: relative;
  width: 14px;
  height: 220px;
}

.legend-bar {
  width: 100%;
  height: 100%;
  border-radius: 7px;

  background: linear-gradient(
    to top,
    #1a0500 0%,
    #5a1a05 30%,
    #c75a1a 65%,
    #ffe4b5 100%
  );
}

.legend-label {
  position: absolute;
  right: 20px;
  font-size: 11px;
  letter-spacing: 0.04em;
}

.legend-label.top {
  top: 0;
  transform: translateY(-50%);
}

.legend-label.mid {
  top: 50%;
  transform: translateY(-50%);
}

.legend-label.bottom {
  bottom: 0;
  transform: translateY(50%);
}

.legend-title {
  writing-mode: vertical-rl;
  transform: rotate(180deg);
  font-size: 11px;
  letter-spacing: 0.18em;
  opacity: 0.6;
}

</style>
</head>

<body>

<!-- HERO -->
<section id="hero">
  <canvas id="hero-canvas"></canvas>
  <canvas id="noise-canvas"></canvas>

  <!-- âœ… AXES -->
  <div class="axis axis-y" id="axis-y"></div>
  <div class="axis axis-x" id="axis-x"></div>

  <!-- âœ… LEGEND -->
  <div id="legend">
    <div class="legend-scale">
      <span class="legend-label top">1.0</span>
      <span class="legend-label mid">0.5</span>
      <span class="legend-label bottom">0.0</span>
  
      <div class="legend-bar"></div>
    </div>
  
    <div class="legend-title">BRIGHTNESS</div>
  </div>
  <!-- âœ… TOOLTIP -->
  <div id="tooltip"></div>

  <h1 class="hero-title" id="hero-title">
    <span id="hero-title-line1">Seoul</span><br/>
    <span id="hero-title-line2">Korea</span>
  </h1>
</section>


<!-- SCROLL -->
<section id="spacer"></section>

<!-- GALLERY -->
<section id="gallery">
  <h2>Series</h2>
  <div class="mini-grid" id="mini-grid"></div>
</section>

<script>



const CITY_TITLES = {
  seoul: ["Seoul", "Korea"],
  tokyo: ["Tokyo", "Japan"],
  oslo: ["Oslo", "Norway"],
  stockholm: ["Stockholm", "Sweden"],
  helsinki: ["Helsinki", "Finland"],
  reykjavik: ["ReykjavÃ­k", "Iceland"],
  longyearbyen: ["Longyearbyen", "Svalbard"],
  new_york: ["New York", "USA"],
  sao_paulo: ["SÃ£o Paulo", "Brazil"],
  cape_town: ["Cape Town", "South Africa"],

  // âœ… ì¶”ê°€ëœ 5ê°œ
  tromso: ["TromsÃ¸", "Norway"],
  anchorage: ["Anchorage", "USA"],
  ushuaia: ["Ushuaia", "Argentina"],
  singapore: ["Singapore", ""],
  quito: ["Quito", "Ecuador"],
};

// âœ… ê°¤ëŸ¬ë¦¬ì— ì‹¤ì œë¡œ ê·¸ë¦´ ë„ì‹œ ëª©ë¡ (ìˆœì„œ = í™”ë©´ ìˆœì„œ)
const cities = [
  "seoul",
  "tokyo",
  "oslo",
  "stockholm",
  "helsinki",
  "reykjavik",
  "longyearbyen",
  "tromso",
  "anchorage",
  "ushuaia",
  "new_york",
  "sao_paulo",
  "cape_town",
  "singapore",
  "quito",
];


/* ---------- HERO CANVAS ---------- */
const heroCanvas = document.getElementById("hero-canvas");
let CURRENT_CITY = "seoul";
let CURRENT_DATA = BRIGHTNESS_DATA[CURRENT_CITY];

const titleLine1 = document.getElementById("hero-title-line1");
const titleLine2 = document.getElementById("hero-title-line2");
titleLine1.textContent = "Seoul";
titleLine2.textContent = "Korea";
const ctx = heroCanvas.getContext("2d");

function resizeHero() {
  heroCanvas.width = window.innerWidth;
  heroCanvas.height = window.innerHeight;

  CURRENT_DATA = BRIGHTNESS_DATA[CURRENT_CITY];
  drawHeatmap(heroCanvas, CURRENT_DATA);
  buildAxes(CURRENT_DATA);
  buildLegend();
}

window.addEventListener("resize", resizeHero);
resizeHero();

/* ---------- TOOLTIP ---------- */
const tooltip = document.getElementById("tooltip");

heroCanvas.addEventListener("mousemove", (e) => {
  if (!CURRENT_DATA) return;

  const rect = heroCanvas.getBoundingClientRect();
  const px = e.clientX - rect.left;
  const py = e.clientY - rect.top;

  const rows = CURRENT_DATA.dates.length;
  const cols = CURRENT_DATA.times.length;

  const c = Math.floor((px / rect.width) * cols);
  const r = Math.floor((py / rect.height) * rows);

  if (r < 0 || r >= rows || c < 0 || c >= cols) {
    tooltip.style.opacity = 0;
    return;
  }

  const date = CURRENT_DATA.dates[r];
  const time = CURRENT_DATA.times[c];
  const value = CURRENT_DATA.values[r]?.[c];

  tooltip.textContent = `${date} Â· ${time} â€” ${Number(value).toFixed(2)}`;
  tooltip.style.left = e.clientX + "px";
  tooltip.style.top = e.clientY + "px";
  tooltip.style.opacity = 1;
});

heroCanvas.addEventListener("mouseleave", () => {
  tooltip.style.opacity = 0;
});
/* ---------- SCROLL ANIMATION ---------- */
gsap.registerPlugin(ScrollTrigger);

gsap.timeline({
  scrollTrigger: {
    trigger: "#spacer",
    start: "top top",
    end: "bottom top",
    scrub: true
  }
})
.to(".hero-title", {
  opacity: 0,
  y: -120
}, 0)
.to("#hero-canvas", {
  scale: 0.6,
  y: -220,
  ease: "none"
}, 0);

/* ---------- GALLERY ---------- */
const grid = document.getElementById("mini-grid");

Object.entries(BRIGHTNESS_DATA).forEach(([city, data]) => {

  const card = document.createElement("div");
  card.className = "mini-card";

  const title = document.createElement("div");
  title.className = "mini-title";
  title.textContent = data.city_name || city;

  const c = document.createElement("canvas");
  c.width = 260;
  c.height = 140;

  card.appendChild(title);
  card.appendChild(c);
  grid.appendChild(card);

  drawHeatmap(c, data);

 card.onclick = () => {
  CURRENT_CITY = city;
  CURRENT_DATA = data;

  drawHeatmap(heroCanvas, CURRENT_DATA);
  buildAxes(CURRENT_DATA);
  buildLegend();

  const [line1, line2] = CITY_TITLES[city] || [city, ""];
  titleLine1.textContent = line1;
  titleLine2.textContent = line2;

  window.scrollTo({ top: 0, behavior: "smooth" });
};
});
function buildAxes(cityData){
  // ----- X axis: 00 ~ 24 (3ì‹œê°„ ê°„ê²©) -----
  const axisX = document.getElementById("axis-x");
  axisX.innerHTML = "";

  // cityData.times = ["00:00","00:30",...,"23:30"] (48ì¹¸) 
  const times = cityData.times;
  const want = new Set(["00:00","03:00","06:00","09:00","12:00","15:00","18:00","21:00"]);
  times.forEach(t => {
    if (!want.has(t)) return;
    const s = document.createElement("span");
    s.textContent = t.slice(0,2);
    axisX.appendChild(s);
  });
  // ë§ˆì§€ë§‰ 24
  const s24 = document.createElement("span");
  s24.textContent = "24";
  axisX.appendChild(s24);

  // ----- Y axis: ì›”ë³„ tickì„ â€œí•´ë‹¹ ì›”ì˜ ì²« ë‚ ì§œ ìœ„ì¹˜â€ì— ì°ê¸° -----
  const axisY = document.getElementById("axis-y");
  axisY.innerHTML = "";

  const dates = cityData.dates; // 
  const rows = dates.length;

  const seen = new Set();
  for (let r = 0; r < rows; r++){
    const d = new Date(dates[r] + "T00:00:00");
    const key = d.getFullYear() + "-" + (d.getMonth()+1);
    if (seen.has(key)) continue;
    seen.add(key);

    const label = d.toLocaleString("en-US", { month: "short" }).toUpperCase();

    const tick = document.createElement("div");
    tick.className = "tick";
    tick.textContent = label;

    // r=0ì´ ìœ„ìª½ì´ë¼ê³  ê°€ì • (ë„ˆ ë°ì´í„°ëŠ” 2024-12-01ë¶€í„° ì˜¬ë¼ê°€ë‹ˆê¹Œ ìœ„ê°€ 12ì›” ì‹œì‘) 
    const pct = (r / (rows - 1)) * 100;
    tick.style.top = pct + "%";
    axisY.appendChild(tick);
  }
}
// ===== Legend ìƒì„± =====
function buildLegend(){
  const bar = document.getElementById("legend-bar");
  if (!bar || !window.HEATMAP_COLOR_STOPS) return;

  const stops = window.HEATMAP_COLOR_STOPS;

  const gradient = stops.map(s => {
    const [r, g, b] = s.rgb;
    return `rgb(${r},${g},${b}) ${Math.round(s.v * 100)}%`;
  }).join(", ");

  bar.style.background = `linear-gradient(to top, ${gradient})`;
}

</script>

</body>
</html>
